<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>FOOD HOME √¢‚Ç¨‚Äù Listes de courses</title>
    <link rel="stylesheet" href="/static/css/common.css" />
    <link rel="stylesheet" href="/static/css/courses.css" />
    <style>
      /* Toggle vues */
      .view-toggle {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
        justify-content: center;
      }

      .toggle-btn {
        padding: 12px 28px;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(59, 130, 246, 0.2);
        border-radius: var(--radius-full);
        cursor: pointer;
        transition: all var(--transition-base);
        font-weight: var(--font-weight-semibold);
        font-size: 15px;
      }

      .toggle-btn.active {
        background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
        color: white;
        border-color: transparent;
      }

      /* Grille de cat√É¬©gories */
      .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .category-btn {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 2px solid rgba(59, 130, 246, 0.15);
        border-radius: var(--radius-xl);
        padding: 24px 16px;
        cursor: pointer;
        transition: all var(--transition-base);
        text-align: center;
        position: relative;
      }

      .category-btn:hover {
        background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15);
      }

      .category-btn .icon {
        font-size: 40px;
        display: block;
        margin-bottom: 8px;
      }

      .category-btn .name {
        font-weight: var(--font-weight-bold);
        font-size: 14px;
        color: var(--text-primary);
      }

      .category-btn .badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: #0ea5e9;
        color: white;
        border-radius: var(--radius-full);
        padding: 4px 10px;
        font-size: 12px;
        font-weight: var(--font-weight-bold);
      }

      /* Drawer (tiroir lat√É¬©ral) */
      .drawer-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        z-index: 999;
        display: none;
      }

      .drawer-backdrop.active {
        display: block;
        animation: fadeIn 0.2s ease-out;
      }

      .drawer {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        width: 90%;
        max-width: 500px;
        background: white;
        box-shadow: -4px 0 32px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .drawer.active {
        transform: translateX(0);
      }

      .drawer-header {
        padding: 24px;
        border-bottom: 2px solid rgba(59, 130, 246, 0.1);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      }

      .drawer-header h2 {
        margin: 0;
        font-size: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .drawer-close {
        background: rgba(59, 130, 246, 0.1);
        border: none;
        width: 36px;
        height: 36px;
        border-radius: var(--radius-full);
        cursor: pointer;
        font-size: 20px;
        color: #0ea5e9;
        transition: all var(--transition-fast);
      }

      .drawer-close:hover {
        background: rgba(59, 130, 246, 0.2);
        transform: translateX(-4px);
      }

      .drawer-body {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
      }

      .drawer-footer {
        padding: 20px 24px;
        border-top: 2px solid rgba(59, 130, 246, 0.1);
        display: flex;
        gap: 12px;
        background: rgba(240, 249, 255, 0.5);
      }

      /* Items avec checkbox */
      .item-group {
        margin-bottom: 24px;
      }

      .item-group-title {
        font-size: 15px;
        font-weight: var(--font-weight-bold);
        color: var(--text-secondary);
        margin-bottom: 12px;
        padding-left: 8px;
        border-left: 3px solid #0ea5e9;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 12px;
        background: rgba(240, 249, 255, 0.5);
        border-radius: var(--radius-md);
        margin-bottom: 8px;
        transition: all var(--transition-fast);
      }

      .checkbox-item:hover {
        background: rgba(224, 242, 254, 0.8);
        transform: translateX(4px);
      }

      .checkbox-item input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      .checkbox-item label {
        flex: 1;
        cursor: pointer;
        font-size: 15px;
      }

      .checkbox-item.checked {
        opacity: 0.5;
      }

      .checkbox-item.checked label {
        text-decoration: line-through;
      }

      /* Vue liste courses */
      .shopping-view {
        display: none;
      }

      .shopping-view.active {
        display: block;
      }

      .shopping-category {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(59, 130, 246, 0.1);
        border-radius: var(--radius-xl);
        padding: 20px;
        margin-bottom: 16px;
      }

      .shopping-category-header {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 18px;
        font-weight: var(--font-weight-extrabold);
        color: #0ea5e9;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 2px solid rgba(14, 165, 233, 0.2);
      }

      .shopping-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(240, 249, 255, 0.5);
        border-radius: var(--radius-md);
        margin-bottom: 8px;
      }

      .shopping-item input[type="checkbox"] {
        width: 22px;
        height: 22px;
      }

      .shopping-item label {
        flex: 1;
        cursor: pointer;
      }

      .shopping-item.checked {
        opacity: 0.5;
      }

      .shopping-item.checked label {
        text-decoration: line-through;
      }

      /* Bouton de suppression dans la shopping list */
      .btn-delete-item {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        border-radius: var(--radius-md);
        padding: 6px 10px;
        cursor: pointer;
        font-size: 16px;
        transition: all var(--transition-fast);
        flex-shrink: 0;
      }

      .btn-delete-item:hover {
        background: rgba(239, 68, 68, 0.2);
        transform: scale(1.1);
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
      }

      .empty-state::before {
        content: "√∞≈∏‚Ä∫‚Äô";
        display: block;
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.6;
      }

      .categories-view,
      .shopping-view {
        display: none;
      }

      .categories-view.active,
      .shopping-view.active {
        display: block;
      }

      /* Indicateur de scroll dans le drawer */
      .scroll-indicator-drawer {
        text-align: center;
        padding: 30px 20px 20px;
        color: var(--text-muted);
        font-size: 12px;
        opacity: 0.6;
        margin-top: 20px;
      }

      .scroll-indicator-drawer span {
        display: block;
        font-size: 28px;
        margin-bottom: 6px;
        animation: bounceDrawer 2s ease-in-out infinite;
      }

      @keyframes bounceDrawer {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-6px); }
      }

      .scroll-indicator-drawer p {
        margin: 0;
        font-style: italic;
      }

      /* Am√©lioration du scroll sur mobile dans le drawer */
      .drawer-body {
        -webkit-overflow-scrolling: touch; /* Scroll fluide iOS */
      }

      /* Indicateur de scroll dans la shopping list */
      .scroll-indicator-shopping {
        text-align: center;
        padding: 40px 20px 20px;
        color: var(--text-muted);
        font-size: 12px;
        opacity: 0.6;
        margin-top: 30px;
      }

      .scroll-indicator-shopping span {
        display: block;
        font-size: 28px;
        margin-bottom: 6px;
        animation: bounceShopping 2s ease-in-out infinite;
      }

      @keyframes bounceShopping {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-6px); }
      }

      .scroll-indicator-shopping p {
        margin: 0;
        font-style: italic;
      }

      @media (max-width: 768px) {
        .drawer {
          width: 100%;
          max-width: 100%;
        }

        .categories-grid {
          grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
          gap: 12px;
        }

        .category-btn {
          padding: 20px 12px;
        }

        .category-btn .icon {
          font-size: 32px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="logo">√∞≈∏‚Ä∫‚Äô</div>
        <h1>FOOD HOME √¢‚Ç¨‚Äù Listes de courses</h1>
        <p class="subtitle">S√É¬©lectionne tes cat√É¬©gories et coche tes produits</p>
      </div>

      <div class="card">
        <!-- Toggle vues -->
        <div class="view-toggle">
          <button class="toggle-btn active" onclick="switchView('categories')">
            √∞≈∏‚Äú¬¶ Cat√É¬©gories
          </button>
          <button class="toggle-btn" onclick="switchView('shopping')">
            √∞≈∏‚Äú‚Äπ Liste courses
          </button>
        </div>

        <!-- VUE CAT√É‚Ä∞GORIES -->
        <div id="categoriesView" class="categories-view active">
          <div class="categories-grid" id="categoriesGrid"></div>
        </div>

        <!-- VUE LISTE COURSES -->
        <div id="shoppingView" class="shopping-view">
          <div id="shoppingList"></div>
        </div>

        <!-- Actions -->
        <div class="actions">
          <button class="btn btn-primary" onclick="exportList()">
            √∞≈∏‚Äú¬§ Exporter
          </button>
          <button class="btn btn-secondary" onclick="clearAll()">
            √∞≈∏‚Äî‚Äò√Ø¬∏¬è Tout effacer
          </button>
        </div>
      </div>
    </div>

    <!-- Backdrop -->
    <div id="backdrop" class="drawer-backdrop" onclick="closeDrawer()"></div>

    <!-- Drawer dynamique -->
    <div id="drawer" class="drawer">
      <div class="drawer-header">
        <h2 id="drawerTitle"></h2>
        <button class="drawer-close" onclick="closeDrawer()">&larr;</button>
      </div>
      <div class="drawer-body" id="drawerBody">
        <!-- Le contenu sera inject√© ici dynamiquement -->
        
        <!-- Indicateur de scroll pour mobile -->
        <div class="scroll-indicator-drawer">
          <span>‚ãØ</span>
          <p>Faites d√©filer pour voir tous les produits</p>
        </div>
      </div>
      <div class="drawer-footer">
        <button class="btn btn-primary" onclick="saveDrawer()" style="flex: 1">
          √∞≈∏‚Äô¬æ Sauvegarder
        </button>
        <button class="btn btn-secondary" onclick="clearDrawer()">
          √∞≈∏‚Äî‚Äò√Ø¬∏¬è Vider
        </button>
      </div>
    </div>

    <script>
      // D√É¬©finition des cat√É¬©gories et produits
      const CATEGORIES = {
        // PYRAMIDE ALIMENTAIRE
        boissons: {
          icon: "√∞≈∏‚Äô¬ß",
          name: "Boissons",
          order: 1,
          items: ["Eau", "Sanpellegrino", "Jus", "Lait"],
        },
        cereales: {
          icon: "√∞≈∏≈í¬æ",
          name: "C√É¬©r√É¬©ales & F√É¬©culents",
          order: 2,
          items: ["P√É¬¢tes", "Semoule", "Riz", "Bl√É¬©", "Pain"],
        },
        fruits: {
          icon: "√∞≈∏¬ç≈Ω",
          name: "Fruits & L√É¬©gumes",
          order: 3,
          priority: true,
          groups: {
            Fruits: ["Pommes", "Bananes", "Noix", "Abricots"],
            L√É¬©gumes: ["Tomates", "Betteraves", "Salade", "Carottes"],
          },
        },
        laitiers: {
          icon: "√∞≈∏¬•‚Ä∫",
          name: "Produits laitiers",
          order: 4,
          items: [
            "Fromages",
            "Yaourts",
            "Fromage blanc",
            "Fromage r√É¬¢p√É¬©",
            "Skyr",
            "Lait",
          ],
        },
        proteines: {
          icon: "√∞≈∏¬ç‚Äì",
          name: "Prot√É¬©ines",
          order: 5,
          groups: {
            Viandes: ["B√Ö‚Äúuf", "Porc", "Veau", "Poulet"],
            Poissons: ["Cabillaud", "Thon", "Truite", "Saumon"],
          },
        },
        graisses: {
          icon: "√∞≈∏¬ßÀÜ",
          name: "Mati√É¬®res grasses",
          order: 6,
          items: ["Huile olive", "Huile colza", "Beurre", "Margarine"],
        },
        sucres: {
          icon: "√∞≈∏¬ç¬¨",
          name: "Sucreries",
          order: 7,
          items: ["G√É¬¢teaux", "Bonbons", "Chocolats", "Nutella", "Confiture"],
        },

        // AUTRES CAT√É‚Ä∞GORIES
        condiments: {
          icon: "√∞≈∏¬ß‚Äö",
          name: "Condiments",
          order: 8,
          items: [
            "Sel",
            "Poivre",
            "√É‚Ä∞pices",
            "Ketchup",
            "Moutarde",
            "Mayonnaise",
            "Cornichons",
          ],
        },
        transformes: {
          icon: "√∞≈∏¬ç‚Ä¢",
          name: "Produits transform√É¬©s",
          order: 9,
          items: [
            "Pain Harris",
            "Farritas",
            "Pizzas",
            "Lardons",
            "Cr√É¬®me fra√É¬Æche",
            "Saucisses Herta",
            "Jambon Herta",
            "Cordons bleus",
            "Nuggets",
            "Cr√É¬®mes desserts",
            "Corn flakes",
            "Biscottes",
          ],
        },
        apero: {
          icon: "√∞≈∏¬ç¬∏",
          name: "Ap√É¬©ro",
          order: 10,
          groups: {
            Alcools: ["Gin", "Aperol", "Tonic", "Get 27", "Bailey"],
            Grignotage: ["Cacahu√É¬®tes", "Chips", "Saucisson"],
          },
        },
        hygiene: {
          icon: "√∞≈∏¬ß¬¥",
          name: "Hygi√É¬®ne",
          order: 11,
          items: [
            "Savon",
            "Shampoing",
            "Cotons-tiges",
            "Coton d√É¬©maquillant",
            "Dentifrice",
            "D√É¬©odorant",
          ],
        },
        menage: {
          icon: "√∞≈∏¬ß¬π",
          name: "Produits m√É¬©nagers",
          order: 12,
          items: [
            "Liquide vaisselle",
            "Lessives",
            "Adoucissant",
            "Liti√É¬®re",
            "Calgon",
            "Powerball",
            "Sac poubelle",
            "Aluminium",
            "Papier cuisson",
            "Cellophane",
          ],
        },
        wc: {
          icon: "√∞≈∏≈°¬Ω",
          name: "WC",
          order: 13,
          items: ["Papier toilette", "Canard WC", "D√É¬©sodorisant"],
        },
        salon: {
          icon: "√∞≈∏‚Ä¢¬Ø√Ø¬∏¬è",
          name: "Salon",
          order: 14,
          items: ["Bougies", "Allume-feu", "Allumettes"],
        },
        electromenager: {
          icon: "√∞≈∏‚Äô¬°",
          name: "√É‚Ä∞lectrom√É¬©nager",
          order: 15,
          items: ["Ampoules", "Piles"],
        },
        autres: {
          icon: "√∞≈∏‚Äú¬¶",
          name: "Autres",
          order: 16,
          items: [], // Rempli dynamiquement depuis l'API
        },
      };

      // √É‚Ä∞tat
      let selections = {};
      let currentCategory = null;

      // Init
      function init() {
        // Initialiser selections
        Object.keys(CATEGORIES).forEach((key) => {
          selections[key] = {};
          const cat = CATEGORIES[key];
          if (cat.items) {
            cat.items.forEach((item) => (selections[key][item] = false));
          } else if (cat.groups) {
            Object.values(cat.groups).forEach((items) => {
              items.forEach((item) => (selections[key][item] = false));
            });
          }
        });

        renderCategories();
        loadFromAPI();
      }

      // Render grille cat√É¬©gories
      function renderCategories() {
        const grid = document.getElementById("categoriesGrid");

        const sorted = Object.entries(CATEGORIES).sort(
          (a, b) => a[1].order - b[1].order
        );

        grid.innerHTML = sorted
          .map(([key, cat]) => {
            const count = Object.values(selections[key]).filter(
              (v) => v
            ).length;
            return `
                    <div class="category-btn" onclick="openDrawer('${key}')">
                        ${count > 0 ? `<div class="badge">${count}</div>` : ""}
                        <span class="icon">${cat.icon}</span>
                        <span class="name">${cat.name}</span>
                    </div>
                `;
          })
          .join("");
      }

      // Ouvrir drawer
      function openDrawer(categoryKey) {
        currentCategory = categoryKey;
        const cat = CATEGORIES[categoryKey];

        document.getElementById(
          "drawerTitle"
        ).innerHTML = `${cat.icon} ${cat.name}`;

        let html = "";

        if (cat.items) {
          html = cat.items
            .map(
              (item) => `
                    <div class="checkbox-item ${
                      selections[categoryKey][item] ? "checked" : ""
                    }">
                        <input type="checkbox" 
                               id="item-${item}" 
                               ${selections[categoryKey][item] ? "checked" : ""}
                               onchange="toggleItem('${categoryKey}', '${item}')">
                        <label for="item-${item}">${item}</label>
                    </div>
                `
            )
            .join("");
        } else if (cat.groups) {
          html = Object.entries(cat.groups)
            .map(
              ([groupName, items]) => `
                    <div class="item-group">
                        <div class="item-group-title">${groupName}</div>
                        ${items
                          .map(
                            (item) => `
                            <div class="checkbox-item ${
                              selections[categoryKey][item] ? "checked" : ""
                            }">
                                <input type="checkbox" 
                                       id="item-${item}" 
                                       ${
                                         selections[categoryKey][item]
                                           ? "checked"
                                           : ""
                                       }
                                       onchange="toggleItem('${categoryKey}', '${item}')">
                                <label for="item-${item}">${item}</label>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                `
            )
            .join("");
        }

        document.getElementById("drawerBody").innerHTML = html;
        document.getElementById("drawer").classList.add("active");
        document.getElementById("backdrop").classList.add("active");
      }

      // Fermer drawer
      function closeDrawer() {
        document.getElementById("drawer").classList.remove("active");
        document.getElementById("backdrop").classList.remove("active");
        renderCategories();
      }

      // Toggle item
      function toggleItem(category, item) {
        selections[category][item] = !selections[category][item];
        const checkbox = document.getElementById(`item-${item}`);
        const parent = checkbox.closest(".checkbox-item");
        parent.classList.toggle("checked");
      }

      // Save drawer
      function saveDrawer() {
        closeDrawer();
        saveToAPI();
      }

      // Clear drawer
      function clearDrawer() {
        if (!confirm("Vider cette cat√É¬©gorie ?")) return;

        Object.keys(selections[currentCategory]).forEach((item) => {
          selections[currentCategory][item] = false;
        });

        openDrawer(currentCategory);
      }

      // Switch view
      function switchView(view) {
        document
          .querySelectorAll(".toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));

        if (view === "categories") {
          document
            .querySelector(".toggle-btn:first-child")
            .classList.add("active");
          document.getElementById("categoriesView").classList.add("active");
          document.getElementById("shoppingView").classList.remove("active");
        } else {
          document
            .querySelector(".toggle-btn:last-child")
            .classList.add("active");
          document.getElementById("categoriesView").classList.remove("active");
          document.getElementById("shoppingView").classList.add("active");
          renderShoppingList();
        }
      }

      // Render shopping list
      function renderShoppingList() {
        const container = document.getElementById("shoppingList");

        // V√É¬©rifier si items
        const hasItems = Object.values(selections).some((cat) =>
          Object.values(cat).some((v) => v)
        );

        if (!hasItems) {
          container.innerHTML =
            '<div class="empty-state">Votre liste est vide<br><span style="font-size: 14px; opacity: 0.7;">Coche des produits dans "Cat√É¬©gories"</span></div>';
          return;
        }

        let html = "";

        Object.entries(CATEGORIES)
          .sort((a, b) => a[1].order - b[1].order)
          .forEach(([key, cat]) => {
            const selected = Object.entries(selections[key]).filter(
              ([_, checked]) => checked
            );

            if (selected.length > 0) {
              html += `
                        <div class="shopping-category">
                            <div class="shopping-category-header">
                                <span>${cat.icon}</span>
                                <span>${cat.name}</span>
                            </div>
                            ${selected
                              .map(
                                ([item, _]) => `
                                <div class="shopping-item">
                                    <input type="checkbox" 
                                           id="shop-${key}-${item}"
                                           onchange="toggleShopItem('${key}', '${item}')">
                                    <label for="shop-${key}-${item}">${item}</label>
                                    <button class="btn-delete-item" onclick="removeFromShoppingList('${key}', '${item}')" title="Supprimer">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    `;
            }
          });

        // Ajouter l'indicateur de scroll en bas
        html += `
          <div class="scroll-indicator-shopping">
            <span>‚ãØ</span>
            <p>Faites d√©filer pour voir les boutons d'action</p>
          </div>
        `;

        container.innerHTML = html;
      }

      // Toggle shopping item
      function toggleShopItem(category, item) {
        const checkbox = document.getElementById(`shop-${category}-${item}`);
        const parent = checkbox.closest(".shopping-item");
        parent.classList.toggle("checked");
      }

      // Remove item from shopping list
      function removeFromShoppingList(category, item) {
        if (!confirm(`Retirer "${item}" de la liste ?`)) return;
        
        // D√©cocher l'item dans les s√©lections
        selections[category][item] = false;
        
        // Re-render la liste
        renderShoppingList();
        
        // Sauvegarder
        saveToAPI();
      }

      // Export
      function exportList() {
        let text = "√∞≈∏‚Äú‚Äπ LISTE DE COURSES\n\n";

        Object.entries(CATEGORIES)
          .sort((a, b) => a[1].order - b[1].order)
          .forEach(([key, cat]) => {
            const selected = Object.entries(selections[key]).filter(
              ([_, checked]) => checked
            );

            if (selected.length > 0) {
              text += `\n${cat.icon} ${cat.name.toUpperCase()}\n`;
              selected.forEach(([item, _]) => {
                text += `√¢Àú¬ê ${item}\n`;
              });
            }
          });

        navigator.clipboard.writeText(text);
        alert("√¢≈ì‚Ä¶ Liste copi√É¬©e !");
      }

      // Clear all
      function clearAll() {
        if (!confirm("Tout effacer ?")) return;

        Object.keys(selections).forEach((cat) => {
          Object.keys(selections[cat]).forEach((item) => {
            selections[cat][item] = false;
          });
        });

        renderCategories();
        saveToAPI();
      }

      // Load from API
      async function loadFromAPI() {
        try {
          const response = await fetch("/api/shopping_list");
          const data = await response.json();

          if (data.success && data.items && data.items.length > 0) {
            console.log(`√∞≈∏‚Äú¬• ${data.items.length} items charg√É¬©s depuis l'API`);

            // Ajouter les items dans la cat√É¬©gorie "Autres"
            data.items.forEach((item) => {
              // Ajouter l'item s'il n'existe pas d√É¬©j√É¬†
              if (!CATEGORIES.autres.items.includes(item)) {
                CATEGORIES.autres.items.push(item);
              }
              // Cocher l'item
              selections.autres[item] = true;
            });
          }

          renderCategories();
        } catch (error) {
          console.error("Erreur chargement API:", error);
          renderCategories();
        }
      }

      // Save to API
      async function saveToAPI() {
        const allItems = [];

        Object.entries(selections).forEach(([cat, items]) => {
          Object.entries(items).forEach(([item, checked]) => {
            if (checked) allItems.push(item);
          });
        });

        try {
          await fetch("/api/shared_data", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ shopping_list: allItems }),
          });
        } catch (error) {
          console.error("Erreur:", error);
        }
      }

      // Init on load
      window.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
